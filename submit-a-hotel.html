<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Submit A Hotel — AmicusHost</title>

<!-- Leaflet CSS -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
  integrity="sha256-sA+e2rHk6vT8v2w1m0Qbq3uFQwqgYq4f+ZfQbHfS+7M=" crossorigin=""/>

<!-- Chart.js (optional, already available if you want graphs later) -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

<style>
:root{
  --accent:#0ea5a4; --muted:#64748b; --bg:#f6f9fb; --card:#fff;
  --radius:12px;
}
*{box-sizing:border-box;font-family:Inter,system-ui,Segoe UI,Roboto,Arial;}
body{margin:0;background:var(--bg);color:#0f172a}
.container{max-width:1200px;margin:20px auto;padding:18px}
.header{display:flex;align-items:center;gap:14px;margin-bottom:18px}
.logo{width:56px;height:56px;border-radius:10px;background:linear-gradient(135deg,#06b6d4,var(--accent));display:flex;align-items:center;justify-content:center;color:white;font-weight:700}
.title{font-size:20px;font-weight:700;color:var(--accent)}
.layout{display:grid;grid-template-columns:350px 1fr;gap:16px}
@media(max-width:980px){.layout{grid-template-columns:1fr}}
.card{background:var(--card);border-radius:var(--radius);padding:14px;box-shadow:0 8px 24px rgba(12,18,31,0.06)}
.input,select,textarea{width:100%;padding:8px;border:1px solid #e6edf3;border-radius:8px;margin-bottom:8px}
.btn{background:var(--accent);color:white;padding:10px 12px;border-radius:10px;border:none;cursor:pointer}
.btn.ghost{background:#eef2f2;color:#0f172a}
.filter-row{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:8px}
.hotel-card{border-radius:8px;padding:10px;background:#fff;margin-bottom:10px;box-shadow:0 2px 8px rgba(2,6,23,0.04)}
.small{font-size:13px;color:var(--muted)}
.map-wrap{height:520px;border-radius:10px;overflow:hidden}
.results-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}
.flex{display:flex;gap:8px;align-items:center}
.badge{padding:6px 8px;border-radius:999px;background:#eef2f2;color:#0f766e;font-weight:600;font-size:12px}
.footer{margin-top:18px;font-size:13px;color:var(--muted);text-align:center}

/* mobile tweaks */
@media(max-width:520px){
  .map-wrap{height:350px}
  .logo{width:48px;height:48px}
}
</style>
</head>
<body>
  <div class="container">
    <div class="header">
      <div class="logo">AC</div>
      <div>
        <div class="title">AmicusHost — Submit A Hotel</div>
        <div class="small">Find eco-friendly hotels (EU, US, Asia, Middle East). Submit hotels, see map, or list your CO2 rating.</div>
      </div>
    </div>

    <div class="layout">
      <!-- LEFT: Filters + submission -->
      <div>
        <section class="card">
          <div style="font-weight:700;margin-bottom:8px">Submit a Hotel</div>
          <div class="small">Add a hotel to the directory (will save locally). You can export JSON later.</div>
          <input id="s_name" class="input" placeholder="Hotel name"/>
          <input id="s_country" class="input" placeholder="Country"/>
          <select id="s_region" class="input">
            <option value="US">United States</option>
            <option value="EU">Europe</option>
            <option value="Asia">Asia</option>
            <option value="Middle East">Middle East</option>
            <option value="Africa">Africa</option>
          </select>
          <input id="s_cert" class="input" placeholder="Certifications (comma separated)"/>
          <input id="s_co2" class="input" placeholder="CO2 rating (Ultra-Low/Low/Medium)"/>
          <input id="s_aff" class="input" placeholder="Affiliate / booking URL"/>
          <input id="s_lat" class="input" placeholder="Latitude (optional)"/>
          <input id="s_lon" class="input" placeholder="Longitude (optional)"/>
          <textarea id="s_notes" class="input" placeholder="Short notes / sustainability features"></textarea>
          <div style="display:flex;gap:8px">
            <button id="submitHotel" class="btn">Submit Hotel</button>
            <button id="downloadJson" class="btn ghost">Download JSON</button>
          </div>

          <hr style="margin:12px 0"/>

          <div style="padding:12px;background:#eef2f2;border-radius:8px;border-left:4px solid var(--accent)">
            <div style="font-weight:700;margin-bottom:8px;color:#0f766e">Welcome to AmicusTravel</div>
            <div class="small" style="color:#0f766e">
              Feel free to add your hotel to our listing. Search by destination, filter by CO₂ rating and certifications, and discover sustainable hotels around the world.
            </div>
          </div>
        </section>
      </div>

      <!-- RIGHT: Map + results -->
      <div>
        <section class="card">
          <div class="results-header">
            <div>
              <div style="font-weight:700">Results</div>
              <div class="small">Click a pin on the map or a card to view details and booking link.</div>
            </div>
            <div class="flex">
              <div class="badge">Dataset: demo + local submissions</div>
            </div>
          </div>

          <div id="resultsList" style="max-height:260px;overflow:auto;margin-bottom:10px"></div>

          <div class="map-wrap card" id="map" style="padding:0"></div>
        </section>

        <section class="card" style="margin-top:12px">
          <div style="font-weight:700;margin-bottom:6px">Selected Hotel</div>
          <div id="selected" class="hotel-card small">No hotel selected</div>
        </section>
      </div>
    </div>

    <div class="footer">AmicusCarbon — prototype directory • Remember: Booking & Expedia API imports require server-side code and API registrations.</div>
  </div>

  <!-- Leaflet JS -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-o9N1j6mbkL6R5v3sM4qVb3Gq7XoygGkq4Hf8mZ6k4EA=" crossorigin=""></script>

  <script>
  // ---------- Sample dataset (start here; you can expand) ----------
  const sampleHotels = [
    {
      id: 'eu-1',
      name: 'Svart Arctic Resort',
      region: 'EU',
      country: 'Norway',
      certifications: ['LEED Platinum'],
      co2_rating: 'Ultra-Low',
      features: ['Net-Zero', 'Solar Energy'],
      affiliate_url: 'https://example.com/book/svart',
      lat: 67.6721,
      lon: 16.1570,
      notes: 'Norwegian net-zero design, on-site solar+hydro'
    },
    {
      id: 'us-1',
      name: '1 Hotel Brooklyn Bridge',
      region: 'US',
      country: 'USA',
      certifications: ['LEED Gold'],
      co2_rating: 'Low',
      features: ['Recycled Materials','Energy-Efficient HVAC'],
      affiliate_url: 'https://example.com/book/1hotel',
      lat: 40.6995,
      lon: -73.9970,
      notes: 'Urban sustainable design, reclaimed wood interiors'
    },
    {
      id: 'asia-1',
      name: 'Soneva Kiri',
      region: 'Asia',
      country: 'Thailand',
      certifications: ['EarthCheck'],
      co2_rating: 'Low',
      features: ['Solar PV','Local sourcing'],
      affiliate_url: 'https://example.com/book/soneva',
      lat: 12.6333,
      lon: 102.6800,
      notes: 'Island resort with strong conservation programs'
    },
    {
      id: 'me-1',
      name: 'Alila Jabal Akhdar',
      region: 'Middle East',
      country: 'Oman',
      certifications: ['Green Globe'],
      co2_rating: 'Medium',
      features: ['Water saving','Energy efficiency'],
      affiliate_url: 'https://example.com/book/alila',
      lat: 23.1394,
      lon: 57.6177,
      notes: 'Mountain resort, water efficiency focus'
    }
  ];

  // ---------- App state ----------
  let hotels = [];          // combined dataset (sample + local)
  let markers = {};         // map markers
  let map, markersLayer;

  // initialize
  function init() {
    // load from localStorage first
    const stored = localStorage.getItem('amicus_hotels_v1');
    if(stored){
      try{
        hotels = JSON.parse(stored).concat(sampleHotels);
      }catch(e){
        hotels = sampleHotels.slice();
      }
    } else {
      hotels = sampleHotels.slice();
    }

    initMap();
    renderResults(hotels);
  }

  // initialize map
  function initMap(){
    map = L.map('map', {zoomControl:true}).setView([20,0], 2);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 19, attribution: '© OpenStreetMap'
    }).addTo(map);
    markersLayer = L.layerGroup().addTo(map);
    refreshMarkers();
  }

  function refreshMarkers(){
    markersLayer.clearLayers();
    markers = {};
    hotels.forEach(h => {
      if(h.lat && h.lon){
        const m = L.marker([h.lat, h.lon]).addTo(markersLayer);
        m.bindPopup(`<strong>${h.name}</strong><br/><small>${h.country} • ${h.co2_rating}</small>`);
        m.on('click', ()=> selectHotel(h.id));
        markers[h.id] = m;
      }
    });
  }

  // render result cards
  function renderResults(list){
    const container = document.getElementById('resultsList');
    if(!list || list.length===0){
      container.innerHTML = '<div class="small">No hotels found</div>';
      return;
    }
    container.innerHTML = list.map(h => `
      <div class="hotel-card" data-id="${h.id}">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div style="font-weight:700">${h.name}</div>
          <div class="small">${h.region} • ${h.country}</div>
        </div>
        <div class="small" style="margin-top:8px">${h.notes || ''}</div>
        <div style="margin-top:8px;display:flex;justify-content:space-between;align-items:center">
          <a href="${h.affiliate_url}" target="_blank" class="small">Book / Details →</a>
          <div class="small">${h.certifications ? h.certifications.join(', ') : ''}</div>
        </div>
      </div>
    `).join('');

    // attach click handlers
    container.querySelectorAll('.hotel-card').forEach(el => {
      el.addEventListener('click', () => {
        const id = el.getAttribute('data-id');
        selectHotel(id);
        // pan to marker if present
        const h = hotels.find(x => x.id===id);
        if(h && h.lat && h.lon) map.setView([h.lat, h.lon], 8);
      });
    });
  }

  // select hotel
  function selectHotel(id){
    const h = hotels.find(x => x.id===id);
    if(!h) return;
    const sel = document.getElementById('selected');
    sel.innerHTML = `<div style="font-weight:700">${h.name}</div>
      <div class="small">${h.country} • ${h.region}</div>
      <div style="margin-top:6px" class="small">${h.notes || ''}</div>
      <div style="margin-top:8px"><strong>Certs:</strong> ${h.certifications ? h.certifications.join(', ') : '—'}</div>
      <div style="margin-top:8px"><strong>CO₂ rating:</strong> ${h.co2_rating || '—'}</div>
      <div style="margin-top:8px"><a href="${h.affiliate_url}" target="_blank" class="btn">Book this hotel</a></div>
    `;
  }

  // search logic
  document.getElementById('searchBtn').addEventListener('click', () => {
    const region = document.getElementById('regionFilter').value;
    const cert = document.getElementById('certFilter').value;
    const co2 = document.getElementById('co2Filter').value;
    const q = document.getElementById('query').value.trim().toLowerCase();

    const filtered = hotels.filter(h => {
      if(region && h.region !== region) return false;
      if(co2 && h.co2_rating !== co2) return false;
      if(cert && !(h.certifications || []).includes(cert)) return false;
      if(q){
        const hay = `${h.name} ${h.country} ${h.notes} ${(h.certifications||[]).join(' ')}`.toLowerCase();
        if(!hay.includes(q)) return false;
      }
      return true;
    });

    renderResults(filtered);
    // update markers visibility: simple approach - recenter to first
    if(filtered.length>0 && filtered[0].lat && filtered[0].lon) map.setView([filtered[0].lat, filtered[0].lon], 4);
  });

  document.getElementById('clearBtn').addEventListener('click', () => {
    document.getElementById('regionFilter').value='';
    document.getElementById('co2Filter').value='';
    document.getElementById('certFilter').value='';
    document.getElementById('query').value='';
    renderResults(hotels);
    map.setView([20,0],2);
  });

  // submit hotel (saves to localStorage)
  document.getElementById('submitHotel').addEventListener('click', () => {
    const name = document.getElementById('s_name').value.trim();
    if(!name) return alert('Please enter hotel name');
    const h = {
      id: 'local-' + Date.now(),
      name,
      country: document.getElementById('s_country').value.trim(),
      region: document.getElementById('s_region').value,
      certifications: document.getElementById('s_cert').value.split(',').map(s=>s.trim()).filter(Boolean),
      co2_rating: document.getElementById('s_co2').value.trim() || 'Medium',
      features: (document.getElementById('s_notes').value||'').split(',').map(s=>s.trim()).filter(Boolean),
      affiliate_url: document.getElementById('s_aff').value.trim() || '#',
      notes: document.getElementById('s_notes').value.trim(),
      lat: parseFloat(document.getElementById('s_lat').value) || null,
      lon: parseFloat(document.getElementById('s_lon').value) || null
    };

    hotels.push(h);
    // persist local submissions only (we preserve sampleHotels separately)
    const localOnly = hotels.filter(x => x.id && x.id.startsWith('local-'));
    localStorage.setItem('amicus_hotels_v1', JSON.stringify(localOnly));
    renderResults(hotels);
    refreshMarkers();
    alert('Hotel submitted (saved locally). You can Download JSON to export this list.');
    // clear form
    ['s_name','s_country','s_cert','s_co2','s_aff','s_notes','s_lat','s_lon'].forEach(id=>{ if(document.getElementById(id)) document.getElementById(id).value=''; });
  });

  // download JSON (exports sample + local)
  document.getElementById('downloadJson').addEventListener('click', () => {
    const data = JSON.stringify(hotels, null, 2);
    const blob = new Blob([data], {type:'application/json'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a'); a.href = url; a.download = 'amicus_hotels_export.json';
    document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
  });

  // refresh markers and dataset on load
  init();

  // ---------- Notes for Booking / Expedia API & production ----------
  /*
    1) Booking.com & Expedia partner APIs require registration and server-side integration:
       - Get API keys from partner portal.
       - Build a backend endpoint that queries the partner API and returns normalized hotel records.
       - Store partner keys on server (never in client JS).
       - You can periodically sync partner data and merge into your dataset or serve live search results.

    2) For paid listings / accept payments:
       - Add PayPal Smart Buttons or Stripe Checkout on the submission or "promote listing" workflow.
       - After successful payment, tag the submission as 'paid' in your DB.

    3) Scaling search:
       - Move dataset to a server-side DB and a search index (Algolia or Elasticsearch) for fast faceted search.

    4) Verification:
       - Provide an "Upload LCA/EPD PDF" workflow (requires a backend to accept files). You can then manually verify and mark hotels as 'verified'.

    5) Map clustering:
       - Use Leaflet.markercluster plugin for dense maps when you scale up.

    6) Security:
       - When moving to production, remove storing API credentials in client, enable HTTPS, and validate user uploads on server side.
  */
  </script>
</body>
</html>
